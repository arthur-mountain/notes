# Unicode

## 1. 基本概念

- **Unicode 編碼**

  Unicode 用以表示世界各種語言的字符，每個字符都有一個獨一無二的 **編碼點**，格式通常為 `U+XXXX`(其中 `XXXX` 為十六進位數字)。

- **UTF-8**

  - **最小單位:** 8 位元(1 byte)

  - **可變長度:** 根據字符範圍可能用 1 至 4 個 bytes

    - ASCII (U+0000 至 U+007F) → 1 byte

    - 拉丁擴展 (U+0080 至 U+07FF) → 2 bytes

    - 複雜字符 (U+0800 至 U+FFFF) → 3 bytes

    - 補充字符 (U+10000 至 U+10FFFF) → 4 bytes

  - **特點:** 與 ASCII 向後兼容

- **UTF-16**

  - **最小單位:** 16 位元(2 bytes)

  - **可變長度:**

    - 基本多文種平面(BMP)內字符 → 2 bytes

    - 補充字符 → 4 bytes(使用一對「代理對」表示)

---

## 2. 與進位制的關係

- **顯示方式:**

  為了簡便表示字符的二進位數據，常用 **十六進位** 格式展示。

  例如，字符 `A` 的 Unicode 編碼是 `U+0041`，而 `中` 的編碼是 `U+4E2D`。

- **關鍵點:**

  - **8** 與 **16** 指的是每個編碼單位的位元數，並非代表十六進位或八進位。

  - 十六進位只是一種便於閱讀與調試的表示法，實際存儲仍是二進位數據。

---

## 3. UTF-8 編碼流程

以字符「中」(U+4E2D) 為例，UTF-8 的編碼步驟如下:

1. **取得 Unicode Code Point**

   - 例: 「中」的編碼點為 `U+4E2D`，轉換成二進位為:

     ```plaintext
     0100 1110 0010 1101
     ```

2. **確定對應的 UTF-8 格式**

   - 根據編碼點範圍:

     - U+0800 至 U+FFFF 使用 3 bytes 格式:

       ```plaintext
       1110xxxx 10xxxxxx 10xxxxxx
       ```

3. **填入二進位數據**

   - 從高位開始，依序將「中」的二進位數據填入格式中的 `x` 位元:

     - 第一個 byte: `1110 0100`(前綴 `1110` 加上高 4 bits `0100`)

     - 第二個 byte: `1011 1000`(前綴 `10` 加上中間 6 bits)

     - 第三個 byte: `1010 1101`(前綴 `10` 加上剩餘 6 bits)

   - 最終結果:

     - 二進位表示: `11100100 10111000 10101101`

     - 十六進位表示: `E4 B8 AD`

---

## 4. Unicode 編碼點範圍的限制

- **固定範圍:**

  Unicode 嚴格定義有效編碼點範圍為 `U+0000` 到 `U+10FFFF`。

- **為何不會超出範圍？**

  - **標準規定:** 超出此範圍的值不屬於合法的 Unicode 編碼點。

  - **編碼機制:**

    - UTF-8 的 4-byte 格式最多能表示 21 bits 的數據，正好覆蓋 `U+10FFFF`。

    - UTF-16 利用代理對來表示 `U+10000` 至 `U+10FFFF`，也無法表示超出範圍的值。

  - **檢查機制:**

    - 多數程式語言和工具會檢查輸入值，如超過範圍則報錯(例如 Python 的 `chr(0x110000)` 會引發 ValueError)或替換成「替代字符」 (`U+FFFD`)。

---

## 總結

- **UTF-8 與 UTF-16** 都是用來對 Unicode 字符進行二進位編碼的方式，但它們採用不同的最小單位(8 位元 vs 16 位元)與編碼格式。

- **十六進位表示** 僅用於簡化二進位數據的展示，不代表內部存儲方式。

- **UTF-8 的編碼步驟** 分為:

  1. 確定字符的 Unicode 編碼點。

  2. 根據編碼點範圍選擇相應的 UTF-8 格式(決定使用幾個 bytes)。

  3. 將編碼點的二進位數據從高位依序填入格式中的 `x` 區域，完成編碼。

- **編碼點範圍的保護:**

  Unicode 的範圍明確限制在 `U+0000` 到 `U+10FFFF`，超出此範圍的值不會被合法編碼，並且通常會引發錯誤或使用替代字符表示。
